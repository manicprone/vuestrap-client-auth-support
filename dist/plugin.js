"use strict";var _extends=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};function generateStore(e){var n=e.debug,t=e.pluginName,i=e.authenticator,o=e.tokenName,s=e.includeUserInfo,r="__",a={namespaced:!0};return a.state={pluginName:t,isAuthenticating:!1,isValidatingSession:!1,isFetchingUserInfo:!1,isExpiringSession:!1,isAuthenticated:!1,authToken:null,userInfo:null},a.getters={pluginName:function(e){return e.pluginName},isAuthenticating:function(e){return e.isAuthenticating},isValidatingSession:function(e){return e.isValidatingSession},isFetchingUserInfo:function(e){return e.isFetchingUserInfo},isExpiringSession:function(e){return e.isExpiringSession},isAuthenticated:function(e){return e.isAuthenticated},authToken:function(e){return e.authToken},userInfo:function(e){return e.userInfo}},a.actions={validateSession:function(e){var i=e.state,a=e.commit,u=e.dispatch,c=e.getters;return a("setIsValidatingSession",!0),n&&console.log("["+t+"] Validating auth session..."),new Promise(function(e){var l=function(e){if(!e)return{value:null,expires_at:null};var i=e.split(r);n&&console.log("["+t+"] Parsed token info from: "+e+" to:",i);var o=i.length>1?Number(i[1]):null;return{value:i[0],expires_at:o}}(localStorage.getItem(o));if(!l.value)return n&&console.log("["+t+"] No user token found. Enabling anonymous session."),a("setIsValidatingSession",!1),i.isAuthenticated&&a("clearSession"),e({is_authenticated:!1,token:null,user_info:null});if(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;n&&console.log("["+t+"] Checking timestamp:",e);var i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e>0&&10===e.toString().length?1e3*e:e}(e);return i>0&&Date.now()>=i}(l.expires_at))return n&&l.value&&console.log("["+t+"] User token has expired."),a("setIsValidatingSession",!1),u("logoutUser").then(function(){return e({is_authenticated:!1,token:null,user_info:null})});a("setIsAuthenticated",!0),a("setAuthToken",l.value),n&&console.log("["+t+"] A valid user session has been established.");var d=c.userInfo;return d||!s?(n&&s&&console.log("["+t+"] Active user info already loaded:",d),e({is_authenticated:!0,token:l.value,user_info:d})):u("fetchUserInfo").then(function(i){return i?(n&&console.log("["+t+"] Active user info to load:",i),u("setUserInfo",i),e({is_authenticated:!0,token:l.value,user_info:i})):e({is_authenticated:!0,token:l.value,user_info:null})}).catch(function(n){return u("logoutUser").then(function(){return e({error:n,is_authenticated:!1,token:null,user_info:null})})}).finally(function(){a("setIsValidatingSession",!1)})})},loginUser:function(e,s){var a=e.commit,u=e.dispatch;return s?(a("setIsAuthenticating",!0),n&&console.log("["+t+"] Authenticating user..."),i.authenticateUser(s).then(function(e){n&&console.log("["+t+"] Retrieved auth info:",e);var i=e.expires_at?""+e.token+r+e.expires_at:""+e.token;return localStorage.setItem(o,i),a("setIsAuthenticating",!1),u("validateSession").then(function(e){return e.is_authenticated?e:Promise.reject(e.error)})}).catch(function(e){return a("setIsAuthenticating",!1),n&&console.log("["+t+"] Excountered provider error when authenticating user:",e),Promise.reject(e)})):Promise.reject(!1)},logoutUser:function(e){var s=e.commit,r=e.getters;s("setIsExpiringSession",!0);var a=r.authToken;return i.expireUser(a).catch(function(e){n&&console.log("["+t+"] Encountered provider error when expiring user:",e)}).finally(function(){return n&&console.log("["+t+"] Logging out user session"),localStorage.removeItem(o),s("clearSession"),s("setIsExpiringSession",!1),Promise.resolve(!0)})},fetchUserInfo:function(e){var o=e.commit,s=e.getters;o("setIsFetchingUserInfo",!0);var r=s.authToken;return n&&console.log("["+t+"] Fetching user info from endpoint..."),i.fetchUserInfo(r).then(function(e){return o("setIsFetchingUserInfo",!1),_extends({},e)}).catch(function(e){return n&&console.log("["+t+"] Encountered provider error when fetching user info:",e),o("setIsFetchingUserInfo",!1),Promise.reject(e)})},setUserInfo:function(e,n){e.commit("setUserInfo",n)}},a.mutations={setIsAuthenticated:function(e,n){e.isAuthenticated=n},setAuthToken:function(e,n){e.authToken=n},setUserInfo:function(e,n){e.userInfo=n},clearSession:function(e){e.isAuthenticated=!1,e.authToken=null,e.userInfo=null},setIsAuthenticating:function(e,n){e.isAuthenticating=n},setIsValidatingSession:function(e,n){e.isValidatingSession=n},setIsFetchingUserInfo:function(e,n){e.isFetchingUserInfo=n},setIsExpiringSession:function(e,n){e.isExpiringSession=n}},a}var script={name:"LocalAccountLogin",data:function(){return{activeUsername:this.username,activePassword:this.password}},props:{username:{type:String,default:""},password:{type:String,default:""}},methods:{login:function(){this.$emit("login",{username:this.activeUsername,password:this.activePassword})}}};function normalizeComponent(e,n,t,i,o,s,r,a,u,c){"boolean"!=typeof r&&(u=a,a=r,r=!1);var l,d="function"==typeof t?t.options:t;if(e&&e.render&&(d.render=e.render,d.staticRenderFns=e.staticRenderFns,d._compiled=!0,o&&(d.functional=!0)),i&&(d._scopeId=i),s?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,u(e)),e&&e._registeredComponents&&e._registeredComponents.add(s)},d._ssrRegister=l):n&&(l=r?function(){n.call(this,c(this.$root.$options.shadowRoot))}:function(e){n.call(this,a(e))}),l)if(d.functional){var p=d.render;d.render=function(e,n){return l.call(n),p(e,n)}}else{var f=d.beforeCreate;d.beforeCreate=f?[].concat(f,l):[l]}return t}var normalizeComponent_1=normalizeComponent,isOldIE="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function createInjector(e){return function(e,n){return addStyle(e,n)}}var HEAD=document.head||document.getElementsByTagName("head")[0],styles={};function addStyle(e,n){var t=isOldIE?n.media||"default":e,i=styles[t]||(styles[t]={ids:new Set,styles:[]});if(!i.ids.has(e)){i.ids.add(e);var o=n.source;if(n.map&&(o+="\n/*# sourceURL="+n.map.sources[0]+" */",o+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n.map))))+" */"),i.element||(i.element=document.createElement("style"),i.element.type="text/css",n.media&&i.element.setAttribute("media",n.media),HEAD.appendChild(i.element)),"styleSheet"in i.element)i.styles.push(o),i.element.styleSheet.cssText=i.styles.filter(Boolean).join("\n");else{var s=i.ids.size-1,r=document.createTextNode(o),a=i.element.childNodes;a[s]&&i.element.removeChild(a[s]),a.length?i.element.insertBefore(r,a[s]):i.element.appendChild(r)}}}var browser=createInjector,__vue_script__=script,__vue_render__=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"local-account-login"},[t("form",{attrs:{method:"post"}},[t("div",{staticClass:"input-creds-area"},[t("div",[t("label",[e._v("u")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.activeUsername,expression:"activeUsername"}],attrs:{type:"text",required:""},domProps:{value:e.activeUsername},on:{input:function(n){n.target.composing||(e.activeUsername=n.target.value)}}})]),e._v(" "),t("div",[t("label",[e._v("p")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.activePassword,expression:"activePassword"}],attrs:{type:"password",required:""},domProps:{value:e.activePassword},on:{input:function(n){n.target.composing||(e.activePassword=n.target.value)}}})])]),e._v(" "),t("div",{staticClass:"btn-login-area"},[t("div",{staticClass:"btn-login",on:{click:e.login}},[e._v("Login")])])])])},__vue_staticRenderFns__=[];__vue_render__._withStripped=!0;var __vue_inject_styles__=function(e){e&&e("data-v-fbe87f66_0",{source:"\n.input-creds-area label[data-v-fbe87f66] {\n  font-size: 14px;\n  display: inline-block;\n  line-height: 0.7em;\n  border-right: 1px solid #d9d9d9;\n  width: 2.7em;\n}\n.input-creds-area input[data-v-fbe87f66] {\n  font-size: 15px;\n  margin-bottom: 7px;\n  margin-left: 12px;\n}\n.btn-login-area[data-v-fbe87f66] {\n  margin-left: 15px;\n}\n.btn-login[data-v-fbe87f66] {\n  font-size: 16px;\n  border: 1px solid #e2e2e2;\n  border-radius: 4px;\n  margin: 10px auto 0 auto;\n  padding: 6px 0;\n  width: 90px;\n  cursor: pointer;\n}\n.btn-login[data-v-fbe87f66]:hover {\n  background-color: #d9d9d9;\n  border: 1px solid #d9d9d9;\n}\n\n",map:{version:3,sources:["/Users/wmccraw/git_repos/manic_manifesto/vuestrap-client-auth-support/src/components/LocalAccountLogin.vue"],names:[],mappings:";AAqDA;EACA,eAAA;EACA,qBAAA;EACA,kBAAA;EACA,+BAAA;EACA,YAAA;AACA;AACA;EACA,eAAA;EACA,kBAAA;EACA,iBAAA;AACA;AAEA;EACA,iBAAA;AACA;AACA;EACA,eAAA;EACA,yBAAA;EACA,kBAAA;EACA,wBAAA;EACA,cAAA;EACA,WAAA;EACA,eAAA;AACA;AACA;EACA,yBAAA;EACA,yBAAA;AACA",file:"LocalAccountLogin.vue",sourcesContent:['<template>\n  <div class="local-account-login">\n\n    <form method="post">\n      <div class="input-creds-area">\n        <div>\n          <label>u</label> <input type="text" required v-model="activeUsername" />\n        </div>\n        <div>\n          <label>p</label> <input type="password" required v-model="activePassword" />\n        </div>\n      </div>\n\n      <div class="btn-login-area">\n        <div class="btn-login" v-on:click="login">Login</div>\n      </div>\n    </form>\n\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \'LocalAccountLogin\',\n\n  data() {\n    return {\n      activeUsername: this.username,\n      activePassword: this.password,\n    }\n  },\n\n  props: {\n    username: {\n      type: String,\n      default: \'\',\n    },\n    password: {\n      type: String,\n      default: \'\',\n    },\n  },\n\n  methods: {\n    login() {\n      this.$emit(\'login\', { username: this.activeUsername, password: this.activePassword })\n    },\n  },\n}\n<\/script>\n\n<style scoped>\n\n  .input-creds-area label {\n    font-size: 14px;\n    display: inline-block;\n    line-height: 0.7em;\n    border-right: 1px solid #d9d9d9;\n    width: 2.7em;\n  }\n  .input-creds-area input {\n    font-size: 15px;\n    margin-bottom: 7px;\n    margin-left: 12px;\n  }\n\n  .btn-login-area {\n    margin-left: 15px;\n  }\n  .btn-login {\n    font-size: 16px;\n    border: 1px solid #e2e2e2;\n    border-radius: 4px;\n    margin: 10px auto 0 auto;\n    padding: 6px 0;\n    width: 90px;\n    cursor: pointer;\n  }\n  .btn-login:hover {\n    background-color: #d9d9d9;\n    border: 1px solid #d9d9d9;\n  }\n\n</style>\n']},media:void 0})},__vue_scope_id__="data-v-fbe87f66",__vue_module_identifier__=void 0,__vue_is_functional_template__=!1,LocalAccountLogin=normalizeComponent_1({render:__vue_render__,staticRenderFns:__vue_staticRenderFns__},__vue_inject_styles__,__vue_script__,__vue_scope_id__,__vue_is_functional_template__,__vue_module_identifier__,browser,void 0),pluginName="client-auth-support",defaultNamespace="auth",defaultTokenName="user-auth-token",defaultUnAuthedTo="login",componentNameLocalAccountLogin="local-account-login";function install(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=n.logInit&&!0===n.logInit,i=n.debug&&!0===n.debug,o=n.namespace||defaultNamespace,s=n.tokenName||defaultTokenName,r=n.authenticator,a=n.includeUserInfo&&!0===n.includeUserInfo,u=n.directUnAuthedTo||defaultUnAuthedTo;if(t&&console.log('Vue is being bootstrapped with "'+pluginName+'"'),n.store){var c=generateStore({debug:i,pluginName:pluginName,authenticator:r,tokenName:s,includeUserInfo:a});n.store.registerModule(o,c),n.router&&n.router.beforeEach(function(e,t,i){n.store.dispatch(o+"/validateSession").then(function(n){e.matched.some(function(e){return e.meta.requiresAuth})?n.is_authenticated||e.name===u?i():i({name:u}):i()})})}e.component(componentNameLocalAccountLogin,LocalAccountLogin)}module.exports=install;
